---
title: 【优护助手1.2】公告板-工作提醒设计（日程模块升级）
date: 2016-11-22 20:44:13
categories: 优护助手
tags:
- Feature
---

## 摘要
公告板-工作提醒设计（日程模块升级）
<!--more-->

## 定义

1. 将原有的“日程提醒”功能，进行新的定义：凡是和工作相关的提醒都可以放在这个模块，所以更名为“工作提醒”
2. 本次更新新增“科室公告”功能
3. 整个提醒页面时按照时间维度进行规划。详解如下：
    1. 所有的任务都拥有相关的具体截止时间，所以提醒依然保留：“今日日程”和“近期的工作”两项工作
    2. 科室公告属于低频次，全科室共享的通知，所以将其收纳为一个“科室公告栏”的功能
    3. 将科室公告置于工作提醒中，可以有效唤起护士对其他工作内容的查看

## 交互设计

### 关键交互逻辑

1. 科室公告栏展示逻辑
    1. 科室公告栏位于“工作提醒”中，在工作提醒的右上角“+”号中，新增“新建科室公告”一项。
    2. 公告展示逻辑
        1. 公告拥有展示时段，过期则不提醒。
        2. 当所有公告已过期时，可点击“全部公告”查看所有已过期公告。
        3. 当有未读公告时，在“工作提醒”处显示“NEW”进行提示。点击进入后，公告板处显示正在展示的公告数量，如“5条 展示中”。
        4. 如果没有未读公告，则显示任务项提醒数量。
        5. 前端在列表中，结合UI，默认显示先280个字。
    3. 公告板内逻辑
        1. 所有公告默认全文展示，无下一级页面。
        2. 公告由“名称”、“创建人”、“展示时段（按天）”、“公告内容”构成。其中“公告内容”限制280字。
        3. 对于展示中的公告，无数量限制。
        4. 点击公告板列表中的某个公告，可进入公告详情，展示“已读”情况，详见设计图。
        5. 列表中的已过期公告，不可点击查看详情。
2. 科室公告新建入口
    1. 工作提醒的右上角“+”处。
    2. 科室公告板内右上角“新建”。
    3. 工具页面中“新建科室公告”。
3. 修改公告
    1. 在公告详情页中，有“修改”按钮。点击修改按钮，进入修改页面，修改页面与新建页面一致，但修改页面中显示当前公告详情。
    2. 修改完成后，点击“发布”后，该公告的创建者将被改为修改者。
    2. 自己只能修改自己创建的公告。
    3. 管理员可以修改所有的公告。
    4. 只有展示中的公告可被修改，已过期的公告不可修改。

### 交互设计图
![](/media/14793154691945.jpg)
![](/media/14798006071330.jpg)
![](/media/14793154981734.jpg)

最新的交互图在OWNCLOUD中：
/Users/cman/ownCloud/Public@Youhujia/【UI设计】/优护助手v1.2/公告详细流程图

### FAQ
#### 什么是新公告
未读+未过期 

A: 展示中未读的公告，定义为为未读公告
#### 什么是新任务
没有完成
排班算任务嘛？如果算，怎么算新？
随访算任务嘛？如果算，怎么算新？

A：若没有展示中的公告时，则展示任务数量
#### 对于展示中的公告，无数量限制。
无数量限制的意思是：有个很难触达的大数。这个数多少合适。

A：无数量限制
#### “全部公告”查看所有已过期公告。
这个需要数量限制。现在后台数据默认展示90天，这是时间限制，数量限制也需要考虑，比如200？

A：OK
#### 过期的任务不允许点击详情
即不允许修改，只允许查看。

A：OK
#### 对于已读的公告如果被编辑了对于已读的用户改如何操作
A：已读与编辑是不相关的，未过期的公告都可以被有权限者编辑，与多少人、哪些人已读无关。

陈晨：举个例子，赵帅这个护士对要修改的公告已经做了已读操作，修改公告后并不会重置赵帅的已读信息。
#### 科秘的修改的权限是否等于管理员

A：Yes
#### 详情页面的新建按钮是否应该取消，前端建议修改成修改按钮

A：OK
#### 公告标题能否重复

A：可以
#### 标题的长度要做限制，长度是多少

A：暂时可以限制为50个字符
#### 所有公告默认全文展示，无下一级页面。
280个字是怎么确定的？交互上是否对280个字的全文显示做校验？是否需要前端根据屏幕尺寸动态调节。

A：暂时限制为1000字符。
#### 新建公告开始时间的逻辑是否是默认当天，但是可以设置成未来的时间，是否限制不能创建开始时间是之前的，如果能，如果处理过期问题。
A：不做限制
#### 工具页面本期上线的版本是？
A：v1.1.1

陈晨： 工具页面本期用的是苗苗的交互，版本暂定1.2 ，新工具页面的上线日期产品经理在确定新的节奏。
## 详细方案
### 后端方案
#### 数据模型
整体的模型如下图：
![](/media/14797008838557.jpg)

#### 接口
##### FAQ
- 所有的字段如果空，则没有该项。如果是数组也会没有，而不会返回空数组（臣妾做不到。。）。
##### 需求确认
各方都已经确认
##### Get/Query API For Announcement in Message List

GET /api/nurses/calendars/v2/events?scenario=messageCenter

``` json
{
    "result": {
        "success": true,
        "code": 1
    },
    "new": true,
    "announcement": [
        {
            "eventId": 998,
            "title": "本周重要新闻",
            "author": {
                "name": "王梦超",
                "nurseId": 13414
            },
            "startTime": 1479712913000,
            "endTime": 1479712913000,
            "content": "习近平在讲话中指出，今年9月",
            "readPerson": [{
              "name":"郭苗",
              "avatarUrl" : "http://xxx.com/me.jpg"
            }],    
            "departmentNurseNum": 100
        }
    ],
    "announcementExpire": [
        {
            "eventId": 999,
            "title": "本周重要新闻",
            "author": {
                "name": "王梦超",
                "nurseId": 13414
            },
            "startTime": 1479712913000,
            "endTime": 1479712913000,
            "content": "习近平在讲话中指出，今年9月",
            "readPerson": [{
                "name":"郭苗",
                "avatarUrl" : "http://xxx.com/me.jpg"
              }],
            "departmentNurseNum": 100
        }
    ],
    "today": [
        {
            "eventId": 234,
            "type":1,
            "title": "张秋丽 第1次随访",
            "status": 1,
            "startTime": 1475769600000,
            "endTime": 1475855999000
        }
    ],
    "future": [
        {
            "eventId": 236,
            "type":2,
            "title":"早班",
            "status": 1,
            "startTime": 1475856000000,
            "endTime": 1475942399000,
            "content":"{\"rosterId\":32,\"rosterName\":\"早班\"}"
        }
    ],
    "expire": [
        {
            "eventId": 23,
            "type":1,
            "title": "橘子 第10次随访",
            "status": 1,
            "startTime": 1475251200000,
            "endTime": 1475337599000
        }
    ],
    "roster": [
      {
        "rosterId": 1,
        "startTime": 1475769600000,
        "endTime": 1475820000000,
        "title": "早中班"
      },
      {
        "rosterId": 2,
        "startTime": 1475820000000,
        "endTime": 1475838000000,
        "title": "中班"
      }
    ]
}

```
##### Add announcement

POST /api/nurses/calendars/events/announcement/v1/

``` json
{
  "title": "本周重要新闻",
  "startTime": 1479712913000,
  "day": 5,
  "content": "习近平在讲话中指出，今年9月"
 }

```

##### Get calendar announcement event

GET /api/nurses/calendars/events/announcement/v1/{1}

``` json
{
  "result": {
    "success": true,
    "code": 1
  },
  "eventId": 998,
  "title": "本周重要新闻",
  "author": {
    "name": "王梦超",
    "nurseId": 13414       
  },
  "startTime": 1479712913000,
  "endTime": 1479712913000,
  "content": "习近平在讲话中指出，今年9月",
  "readPerson": [{
    "name" : "郭苗",
    "avatarUrl" : "http://xxx.com/me.jpg"
  }],
  "read":false,
 "departmentNurseNum": 100
}
     
```

##### Update calendar announcement event
PATCH /api/nurses/calendars/events/announcement/v1/{id}

Input:

``` json
{
  "eventId": 3,
  "title":"Changed Title",
  "content":"近平在讲话中指举行的二十国集团",
  "startTime": 1479712913000,
  "day": 5,
  "read": true
}
```

Output:

``` json
{
    "result": {
        "success": true,
        "code": 1
    }
}
```
##### delete calendar announcement event

DELETE /api/nurses/calendars/events/announcement/1/{id}

OUTPUT:

``` json
"result": {
    "success": true,
    "code": 1
}
```

### 上线
#### 可能的问题
1. 原接口废弃，需要停机发布（理论上不影响之前的接口）。
2. 发布新应用，存放Momentum相关

## 项目管理
### 风险点
- 实习生了解程度

### 排期

#### 总体时间

内容 | 时间点
------------ | -------------
详细设计制定及Review | 2016-11-23
前后端开发 | 2016-11-26
测试联调 | 2016-11-28
上线 | 2016-11-29

受优护助手1.1发布影响等其他综合因素，现调整时间安排如下：

**调整后：**

内容 | 时间点
------------ | -------------
详细设计制定及Review | 2016-11-23
前后端开发 | 2016-11-29
测试联调 | 2016-11-30
上线 | 2016-12-1

**备注：**

- 后端29号内部联调。

#### 后端详细内容
**注意：以下详细内容包含功能设计，功能设计Review，开发，自测。**
**注意：请务必重视项目设计和Review，交叉检查。**

模块 | 内容 | 人日 | 人员
----------| ------- | ------------- | ------
Momentum应用搭建 | 1. 框架实现 | 1人日 | 陈晨
Galaxy 接口 | 1. 增删 | 4人日 | 杨淑婷
Galaxy 接口 | 1. 改查 | 4人日 | 袁鑫
Momentum | 1. 增删 | 4人日 | 王梦超
Momentum | 1. 改查 | 4人日 | 程冲
Sophon | 1. 增删 |  2人日 | 卢江
Sophon | 1. 改查 |  2人日 | 林慧芝

#### 前端排期

None



