---
title: 【合肥项目】运营中心
date: 2016-12-26 12:30:00
categories: 合肥
tags:
- Winston
---

## 背景

运营中心项目搭建和接口提供

<!--more-->

## WIKI维护人
ListenYoung

# 开发任务

## youhujia/Winston项目搭建

运营中心相对于之前的系统属于比较独立的部分，讨论后决定单独为其搭建一个新的项目Winston（对不起学文我没看过三体）

## 部分数据库表结构和实体类的实现

因为运营系统需要独立的登录逻辑，可能需要新的表结构存储运营中心客服人员的账号信息，以及在订单中出现的operationlog等对象属性可能还没有来得及在halo中定义，可能需要自己去实现

## 登录接口

用户使用在开发人员处报备的账号和密码进行登录调用的接口

1. 由于要统一经过gateway，所以打算使用类似之前godToken的做法先实现一个比较简单的登录逻辑

## 订单列表接口

通过url中的

draw:12
order[0][column]:4  //第几列（订单时间，订单状态，服务名称）
order[0][dir]:desc
start:25
length:25 
search[value]:hhh  //全局搜索（护士姓名，患者姓名，订单编号，订单状态）
search[regex]:false

这几个字段，来完成对订单的条件检索以及分页处理和排序处理

1. 因为之前确认过datatables做request提供了很多无意义的属性，所以为了接口调用方面和处理方便，需要在url中直接拼入上面的字段方便后端框架直接catch

2. order排序只能传递数字，所以需要和前端同学沟通约定数字代表的是什么字段


## 订单详情

通过传入的orderId，查询到对应订单的响应信息并包装成“订单信息”、“处理订单”、“日志信息”三坨返回

1. 据前端同学说，这里的逻辑可以复用之前的
2. 这里有个buttonMsg，标识当前状态下的订单可以进行何种操作，和前端同学沟通后希望可以使用合肥C端一样的availableAction[] 来完成。

## 推送

将一个订单的信息推送给多个护士或者将一个护士推送给多个订单，这里需要提供nurseId[] 和 orderId[] 后台判断哪个list的数量大于1来决定是哪种一对多的推送

## 退款

根据status的状态决定退款这个action之后，order的状态轮转到哪个

## 操作日志

根据orderId和日志的内容生成一条状态无关的日志，加入到order的operationLog里面

## 状态变更

根据orderId和状态机的下一个状态，对order的状态进行变更同时生成一条状态无关的日志

# 可能有坑的地方

1. 登录的逻辑以及实现（采用Nginx实现，这一版不需要处理）
2. 在订单详情页中的处理订单子页面，会根据部分订单的状态出现未处理的button，在点击这个button之后会生成一条log，同时将订单标记为这个状态下的已处理；每次返回订单详情的时候，需要根据operationLog的list来确定当前状态下的订单是未处理还是已处理

## 详细排期
内容 | 详情 | 人日 | 完成情况
--- | --- | --- | ----
订单列表 |完成订单列表接口的实现 |1 |X 
订单详情 |完成订单详情以及availabAction[]的接入，同时处理订单显示未处理/已处理 |1.5 |X 
推送、退款、操作日志 |- |1 |X 
联调 |和前端同学联调 |1 |X 


# Time

## 2016.12.26 winston 创建 (Kickoff 1st day)

### 完成

* winston 项目搭建

### 进度

 正常

