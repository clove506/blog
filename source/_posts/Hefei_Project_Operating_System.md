---
title: 【合肥项目】 运营系统设计
date: 2016-12-16 15:40:00
categories: 合肥
tags:
- 合肥
---
## 摘要
合肥项目运营系统设计
<!--more-->
## WIKI维护人
张正宇

## 设计理念
- 支持订单状态流转的最小单元

## 运营系统功能概览
 
![运营系统功能](/media/%E8%BF%90%E8%90%A5%E7%B3%BB%E7%BB%9F%E5%8A%9F%E8%83%BD.png)



## 订单检索
- 检索方式
    - 护士姓名；患者姓名；订单编号（精确搜索，是=，不是LIKE）
    - 状态检索：点击某一种状态，可查询此状态下所有订单
- 结果排序：ORDER BY 订单时间 dec，订单状态，服务名称

- 细节说明：
    - 4种方式同时只能使用一种检索，结果显示的是某一个检索的结果
    - 对于需要运营处理的订单，显示处理状态[已处理，未处理]；无需处理的订单显示“-”；
    - 按状态检索需精确到某一个状态，不支持某类状态的检索
    - 点击查看详情进入订单详情页
    - 显示当前检索结果的记录条数
- 需处理的页面
    - 服务中纠纷、订单结束后纠纷、高优先待接单、服务超时、服务异常、退款异常、发起退款异常
- 其他可处理的页面
    - 结束后订单（做限制只允许发起一次结束后纠纷）

![00搜索订单页](/media/00%E6%90%9C%E7%B4%A2%E8%AE%A2%E5%8D%95%E9%A1%B5.png)




## 订单详情页信息
- 订单详情页分3栏：
    - 订单信息[订单基础信息，患者信息，护士信息，服务详情（服务步骤放入日志信息页单独列出）]
    - 处理订单[处理状态（如有）、更改订单状态（如有）、派单（如有）、退款处理（如有）]
    - 日志信息[添加日志、显示日志、服务步骤]

## 订单信息
- 订单基础信息[订单编号、订单时间、订单状态、实际支付金额、服务名称、服务时间、服务地址]
- 患者信息[姓名、性别、年龄、手机号、地址]
- 护士信息[姓名、机构、职位、手机号、星级分数]
- 服务详情[服务名称、服务时长、服务描述]

![10订单详情页-订单信息](/media/10%E8%AE%A2%E5%8D%95%E8%AF%A6%E6%83%85%E9%A1%B5-%E8%AE%A2%E5%8D%95%E4%BF%A1%E6%81%AF.png)




## 订单处理（具体状态对应不同操作，详情参见页面）：

- 处理状态变更[未处理／已处理]
- 订单状态变更
    - 置为退款成功（退款异常／发起退款异常）
    - 置为结束后纠纷（订单结束后患者申诉通过）
- 派单（高优先待接单）
    - 下拉选择框：服务机构、职称、性别「默认全部」、星级分数（全部「默认」，100-80，80-60，...），点击检索
    - 显示字段：姓名，性别，服务机构，职位，手机号，星级分数
    - 排序：ORDER BY 星级分数 dec
    - 勾选护士进行选择，或点击全选进行选择，点击推送进行推送
    - 派单push信息：【标题：订单消息通知】【运营人员为您派了一个新订单】
- 退款处理（服务异常，服务中纠纷，订单结束后纠纷）
    - 不论纠纷由谁发起，均退款给患者，金额可视情况而定
    - 退款和不退款两个按钮，一个文本输入框
    - 文本框填写处理原因，必填，200字以内
    - 点击不退款直接填原因提交
    - 点击退款输入金额设置框，显示金额填写范围（0，金额上限]
    - 点击退款按钮，执行退款操作前先检测当前状态是否有发生改变

![11订单详情页-订单处理](/media/11%E8%AE%A2%E5%8D%95%E8%AF%A6%E6%83%85%E9%A1%B5-%E8%AE%A2%E5%8D%95%E5%A4%84%E7%90%86.png)





## 日志信息
- 增加运营处理日志
    - 点击加号，出现文本框，必填，200字以内，可点击取消隐去文本框，点击提交生成日志
- 操作日志
    - 日志格式：[时间] [角色] [身份] [账户] [动作] [动作相关信息]；如：[2016.06.21 17:31] [患者] [普通] [马冬梅] [提交了订单][-]；
    - 角色有：护士、患者、运营、系统，不同角色用不同颜色标识


![12订单详情页-订单日志](/media/12%E8%AE%A2%E5%8D%95%E8%AF%A6%E6%83%85%E9%A1%B5-%E8%AE%A2%E5%8D%95%E6%97%A5%E5%BF%97.png)

## 服务完成情况
- 服务完成情况（只可见完成状态，不可看评估结果等）
    - 宣教完成情况
    - 评估完成情况
    - 服务步骤完成情况（只可看到其状态）
![13订单详情页-服务完成情况](/media/13%E8%AE%A2%E5%8D%95%E8%AF%A6%E6%83%85%E9%A1%B5-%E6%9C%8D%E5%8A%A1%E5%AE%8C%E6%88%90%E6%83%85%E5%86%B5.png)



## 需要操作的页面功能交互
- 服务中纠纷
    - 显示处理状态
    - 退款操作
        - 如护士申请进入纠纷，退款上限为全额；
        - 如患者申请退款护士拒绝，退款上限为患者填写金额；

![20订单详情页-服务中纠纷](/media/20%E8%AE%A2%E5%8D%95%E8%AF%A6%E6%83%85%E9%A1%B5-%E6%9C%8D%E5%8A%A1%E4%B8%AD%E7%BA%A0%E7%BA%B7.png)




- 订单结束后纠纷
    - 显示处理状态
    - 更改订单状态：若患者取消了纠纷，置为订单结束状态
    - 退款处理
        - 订单结束后患者发起纠纷，上限为平台实际收入金额

![21订单详情页-结束后纠纷](/media/21%E8%AE%A2%E5%8D%95%E8%AF%A6%E6%83%85%E9%A1%B5-%E7%BB%93%E6%9D%9F%E5%90%8E%E7%BA%A0%E7%BA%B7.png)




- 高优先待接单
    - 显示处理状态
    - 派单[已述]

![30订单详情页-高优先待接单](/media/30%E8%AE%A2%E5%8D%95%E8%AF%A6%E6%83%85%E9%A1%B5-%E9%AB%98%E4%BC%98%E5%85%88%E5%BE%85%E6%8E%A5%E5%8D%95.png)



- 派单待处理
    - 显示处理状态
    - 派单

![31订单详情页-派单待确认](/media/31%E8%AE%A2%E5%8D%95%E8%AF%A6%E6%83%85%E9%A1%B5-%E6%B4%BE%E5%8D%95%E5%BE%85%E7%A1%AE%E8%AE%A4.png)



- 服务超时
    - 显示处理状态
    - 修改处理状态

![40订单详情页-服务超时](/media/40%E8%AE%A2%E5%8D%95%E8%AF%A6%E6%83%85%E9%A1%B5-%E6%9C%8D%E5%8A%A1%E8%B6%85%E6%97%B6.png)




- 服务异常
    -  显示处理状态
    -  退款处理：服务异常状态，金额上限为实际支付金额

![41订单详情页-服务异常](/media/41%E8%AE%A2%E5%8D%95%E8%AF%A6%E6%83%85%E9%A1%B5-%E6%9C%8D%E5%8A%A1%E5%BC%82%E5%B8%B8.png)




- 发起退款异常、退款异常
    - 显示处理状态
    - 更改订单状态：置为退款成功状态
![50订单详情页-退款异常](/media/50%E8%AE%A2%E5%8D%95%E8%AF%A6%E6%83%85%E9%A1%B5-%E9%80%80%E6%AC%BE%E5%BC%82%E5%B8%B8.png)

![51订单详情页-发起退款异常](/media/51%E8%AE%A2%E5%8D%95%E8%AF%A6%E6%83%85%E9%A1%B5-%E5%8F%91%E8%B5%B7%E9%80%80%E6%AC%BE%E5%BC%82%E5%B8%B8.png)


- 其他可处理的页面
    - 订单结束状态
    - 更改订单状态：患者在订单结束后需进入纠纷，此处进行状态设置

![22订单详情页-订单结束](/media/22%E8%AE%A2%E5%8D%95%E8%AF%A6%E6%83%85%E9%A1%B5-%E8%AE%A2%E5%8D%95%E7%BB%93%E6%9D%9F.png)



## 需处理的状态：已处理／未处理

订单状态\处理状态变化|触发成为已处理的动作|触发进入下一订单状态动作
---------|---------|---------
服务中纠纷|-|略(由状态机确定)
订单结束后纠纷|-|同上
高优先待接单|-|同上
派单待确认|派单处理|同上
服务超时|点击置为已处理|同上
服务异常|-|同上
发起退款异常、退款异常|-|同上

> 注：“-”表示由状态机可直接导至下一订单状态，无需显示已处理（或者说某一动作同时处触发了：将其置为已处理&将其置为下一订单状态，如退款操作）

## 更改订单状态情况穷举
所在状态|按钮动作|操作后状态
---------|---------|---------
退款异常|置为退款成功|退款成功状态
发起退款异常|置为退款成功|退款成功状态
订单结束|置为结束后纠纷|结束后纠纷状态

## 退款金额上限详解[FYI]

- 退款金额上限[top_amount]：
    - 服务异常，起始退款上限值为实际支付金额，记real_amount
    - 订单结束后纠纷，退款上限值为平台收款支付金额，记platform_amount
    - 患者申请，退款上限值为患者提交金额，记patient_amount
    - 服务人员申诉，退款上限值为实际支付金额，记nurse_amount=real_amount

## 角色&权限

需处理状态|检索订单|查看订单信息|派单&添加日志|退款&订单状态设置
---------|---------|---------|---------|---------
初级运营|√|√|-|-
中级运营|√|√|√|-
高级运营|√|√|√|√

### 日志列表
- 主要给出动作及动作相关信息（col 5&6）的文案，其他列请根据动作的时间、触发者进行具体设置
    - [Datetime] [患者] [普通] [蒋易] [提交订单] [-]；
    - [Datetime] [患者] [普通] [蒋易] [支付成功] [-]；
    - [Datetime] [患者] [普通] [蒋易] [取消订单] [-]；
    - [Datetime] [系统] [Dimension] [] [支付超时] [待支付开始N时间未支付，订单关闭]；
    - [Datetime] [系统] [Dimension] [] [接单超时] [待接单开始N时间未接单，订单进入高优先待接单状态]；
    - [Datetime] [系统] [Dimension] [] [高优先超时] [高优先开始N时间未接单，订单进入带退款状态]；
    - [Datetime] [系统] [DNA] [] [系统自动派单] [进入高优先待接单状态，系统派单]；
    - [Datetime] [护士] [护师] [Carlos] [护士接单] []；
    - [Datetime] [系统] [Dimension] [] [派单超时] [派单无护士接单，订单进入带退款状态]；
    - [Datetime] [患者] [普通] [张海宇] [申请退款] [退款原因：护士服务态度差；退款金额：45.00元；退款说明：这个护师态度有问题，我要求给退部分款项]；
    - [Datetime] [系统] [] [] [服务动作开始] [进入服务中状态]；
    - [Datetime] [系统] [Dimension] [] [服务超时] [服务开始M时间无护理动作，订单进入服务超时状态]；
    - [Datetime] [系统] [Dimension] [] [服务异常] [最后一次服务操作开始M时间无护理动作，订单进入服务异常状态]；
    - [Datetime] [护士] [护师] [Gaby] [服务人员确认完成] [服务完成，订单进入待评状态]；
    - [Datetime] [患者] [普通] [张海宇] [取消退款] [患者取消了退款申请]；（包括退款申请中和服务纠纷状态下的取消）
    - [Datetime] [护士] [高级护师] [Bree] [同意退款] [护士同意了退款]；（包括第一次退款申请时同意和服务纠纷中同意）
    - [Datetime] [护士] [高级护师] [袁鑫] [拒绝退款] [拒绝理由：真真是可怕]；
    - [Datetime] [运营] [中级运营] [陈晨] [同意退款] [退款金额：21.50；说明：就这样吧，就这样吧]；
    - [Datetime] [运营] [中级运营] [卢江] [拒绝退款] [说明：我说了算，就不退钱]；
    - [Datetime] [患者] [VIP] [pual young] [评价] [星级分数：21；评论内容：NULL]；
    - [Datetime] [系统] [Dimension] [] [评价超时] [超时未评价，系统默认评价星级100分，进入订单结束状态]；
    - [Datetime] [系统] [] [] [结算时间到] [订单结束N时间，订单进入结算状态]；
    - [Datetime] [运营] [初级运营] [张跃超] [订单结束后投诉，进入纠纷] [运营添加了结束后投诉]
    - [Datetime] [运营] [中级运营] [丁天奇] [拒绝退款] [说明：真真是无理取闹]；
    - [Datetime] [运营] [中级运营] [丁天奇] [同意退款] [退款金额：22.50；说明：哎呀，就这样吧]；
    - [Datetime] [系统] [财务] [] [退款成功] [退款金额：33.77元]；
    - [Datetime] [系统] [财务] [] [发起退款异常] [请联系程序员哥哥处理]；
    - [Datetime] [系统] [财务] [] [退款异常] [请联系程序员叔叔处理]；
    - [Datetime] [运营] [内容运营] [张正宇] [置为结束后纠纷] [患者发起了结束后纠纷，状态变更]；
    - [Datetime] [运营] [执行运营] [张正宇] [派单] [-]；
    - [Datetime] [运营] [执行运营] [张正宇] [置为已处理] [此单服务超时已处理]；
    - [Datetime] [运营] [执行运营] [张正宇] [置为退款成功] [发起退款异常置为退款成功]；
    - [Datetime] [运营] [执行运营] [张正宇] [置为退款成功] [退款异常置为退款成功]；


